# 開発規約

## 1. はじめに
このドキュメントは、Katorinプロジェクトの開発における基本的な規約を定めます。

## 2. 開発フロー

### 2.1. ブランチ戦略
- `main` ブランチをベースとした開発を行います。
- 機能追加: `feature/<機能名>` ブランチを作成
- バグ修正: `fix/<バグの概要>` ブランチを作成
- ドキュメント更新: `docs/<更新内容>` ブランチを作成
- リファクタリング: `refactor/<対象>` ブランチを作成

### 2.2. プルリクエスト
- すべての変更は、プルリクエスト (PR) を通じて `main` ブランチにマージします。
- PRのタイトルは、コミットメッセージと同様の形式を使用します。
- PR作成時には、以下を含めます:
  - 変更内容の要約
  - テスト方法
  - スクリーンショット (UI変更の場合)
  - 関連するIssue番号

### 2.3. マージ方針
- `main` ブランチへのマージは、Squash and Merge を推奨します。
- マージ後、作業ブランチは削除します。

## 3. コミットメッセージ
- コミットメッセージは、変更内容を簡潔かつ明確に記述します。
- 以下のフォーマットを推奨します。
  ```
  <type>(<scope>): <subject>

  <body>

  <footer>
  ```
  - `type`: feat, fix, docs, style, refactor, test, chore など
  - `scope`: 変更箇所 (例: frontend, api, auth)
  - `subject`: 変更の要約 (50文字以内)
  - `body`: 詳細な変更内容
  - `footer`: 関連するIssue番号など

## 4. コードレビュー
- すべてのコード変更は、少なくとも1名以上のレビュアーによるレビューを必須とします。
- レビューでは、以下の点に注意します。
  - コーディング規約の遵守
  - 設計の妥当性
  - テストの網羅性
  - パフォーマンス
  - セキュリティ

## 5. テスト

### 5.1. テストフレームワーク
- **フロントエンド**: Jest（CRA 標準）+ React Testing Library
- **E2Eテスト**: Playwright または Cypress (検討中)

### 5.2. テスト要件
- 新規機能追加時は、単体テストを必須とします。
- バグ修正時は、再発防止のためのテストケースを追加します。
- 複雑なビジネスロジックには、結合テストを追加します。

### 5.3. テストカバレッジ
- 目標カバレッジ: 70%以上
- 重要な機能 (認証、決済など) は 90%以上を目指します。

### 5.4. テスト実行
- ローカルでのテスト実行: `npm test --prefix frontend`
- CI/CD での自動テスト実行（後述）

## 6. ドキュメンテーション
- APIの変更や複雑なロジックには、適宜ドキュメントを更新または追加します。
- README.mdは常に最新の状態を保ちます。
- コードコメントは、「なぜ」を説明します (「何を」はコードから読み取れるため)。

## 7. CI/CD

### 7.1. GitHub Actions
- プルリクエスト作成時に自動で以下を実行します:
  - リンター (ESLint)
  - フォーマッター チェック (Prettier)
  - 型チェック (TypeScript)
  - テスト実行
  - ビルド確認

### 7.2. デプロイ
- `main` ブランチへのマージ時に、自動デプロイを実行します。
- デプロイ先: Vercel (フロントエンド), Supabase (バックエンド)

## 8. 環境管理

### 8.1. 環境の種類
- **開発環境 (local)**: 開発者のローカルマシン
- **ステージング環境 (staging)**: 本番環境のレプリカ (検討中)
- **本番環境 (production)**: エンドユーザーが使用

### 8.2. 環境変数
- 環境変数は `.env.local` ファイルで管理します。
- `.env.local` は Git 追跡対象外とし、`.env.example` にサンプルを記載します。
- Supabase 関連の環境変数:
  - フロントエンド: `REACT_APP_SUPABASE_URL`, `REACT_APP_SUPABASE_ANON_KEY`
  - サーバーサイド: `SUPABASE_URL`, `SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_ROLE_KEY`

### 8.3. Supabase環境
- ローカル開発: `npx supabase start` でローカルSupabaseを起動
- マイグレーション管理: `supabase/migrations/` ディレクトリで管理
- 本番環境への適用: `npx supabase db push` (慎重に実行)

## 9. セキュリティ

### 9.1. シークレット管理
- APIキー、パスワード、トークンなどは、環境変数で管理します。
- コードに直接記述しません。
- GitHub Secretsを使用して、CI/CD環境で管理します。

### 9.2. 依存関係の管理
- `npm audit` を定期的に実行し、脆弱性をチェックします。
- 依存パッケージは最新の安定版を使用します。

### 9.3. コードレビューでの確認事項
- XSS、CSRF、SQLインジェクションなどの脆弱性がないか確認します。
- 認証・認可が適切に実装されているか確認します。
