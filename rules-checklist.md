# コーディング規約チェックリスト

このドキュメントは、プルリクエストやコードレビュー時に確認すべき項目のチェックリストです。

## ファイル・コード構造

- [ ] ファイル名は適切な命名規則に従っているか
  - コンポーネントファイル: `PascalCase`
  - その他: `camelCase` または `kebab-case`
- [ ] ディレクトリ構造は機能ベース（Feature-based）で整理されているか
  - 管理者: `admin/`
  - 認証: `auth/`
  - チーム: `team/`
  - 共通: `components/`
- [ ] インデントはスペース2つで統一されているか（タブ禁止）

## TypeScript

- [ ] すべての変数・関数・propsに明示的な型定義があるか
- [ ] `any` の使用を避けているか（やむを得ない場合は `unknown` を検討）
- [ ] `unknown` を使用する場合、型ガードで型を絞り込んでいるか
- [ ] オブジェクトの形状定義に `interface` を使用しているか
- [ ] Union型・Intersection型に `type` を使用しているか
- [ ] 型アサーション (`as`) を最小限に抑えているか

## React / コンポーネント

- [ ] 関数コンポーネントとHooksを使用しているか
- [ ] 単一責任の原則に従っているか（コンポーネントが複雑すぎないか）
- [ ] propsの型定義が明示的に行われているか
- [ ] カスタムHooksは `use` プレフィックスで始まっているか
- [ ] `useEffect` の依存配列が正しく設定されているか
- [ ] 無限ループのリスクがないか（依存配列の確認）
- [ ] 不要な再レンダリングを避けるため、`React.memo`, `useMemo`, `useCallback` を適切に使用しているか（過度な最適化は避ける）

## Material-UI (MUI) v7

- [ ] MUI v7の新しいGrid2 APIを使用しているか
  - ❌ `import Grid from '@mui/material/Grid2';`
  - ✅ `import { Grid } from '@mui/material';`
- [ ] Gridコンポーネントで `size` プロパティを使用しているか
  - ❌ `<Grid item xs={12} sm={6}>`
  - ✅ `<Grid size={{ xs: 12, sm: 6 }}>`

## Supabase / データベース

- [ ] スキーマ変更は必ずマイグレーションファイルを通じて行っているか
- [ ] マイグレーションファイルは `supabase/migrations/` に配置されているか
- [ ] すべてのテーブルにRLSポリシーが設定されているか
- [ ] クエリビルダーを使用し、生のSQLを避けているか
- [ ] エラーハンドリングを適切に行っているか
- [ ] リアルタイム機能のサブスクリプションは適切にクリーンアップされているか

## 国際化 (i18n)

- [ ] すべてのUIテキストは `t()` 関数を使用して翻訳可能になっているか
- [ ] ハードコーディングされたテキストがないか
- [ ] 翻訳キーは階層構造で記述されているか (例: `auth.login.title`)
- [ ] 翻訳キーは `camelCase` で命名されているか
- [ ] 動的な値は変数として渡しているか (例: `t('greeting', { name })`)

## セキュリティ

- [ ] 認証はSupabase Authを使用しているか（独自実装を避ける）
- [ ] 認証が必要なページは認証ガードで保護されているか
- [ ] 環境変数は `.env.local` で管理されているか
- [ ] `.env.local` は `.gitignore` に含まれているか
- [ ] フロントエンドの環境変数は `REACT_APP_` プレフィックスを使用しているか
- [ ] サービスロールキーなどの機密情報をフロントエンドで使用していないか
- [ ] ユーザー入力は常にエスケープされているか
- [ ] `dangerouslySetInnerHTML` の使用を避けているか
- [ ] Supabaseクライアントのクエリビルダーを使用しているか（SQLインジェクション対策）

## アクセシビリティ (a11y)

- [ ] セマンティックHTMLを使用しているか (`<button>`, `<nav>`, `<main>` など)
- [ ] `<div>` や `<span>` を過度に使用していないか
- [ ] 必要に応じてARIA属性を追加しているか
- [ ] すべてのインタラクティブ要素がキーボードで操作可能か
- [ ] フォーカス状態が視覚的に明確か
- [ ] WCAG 2.1 AA基準を満たすコントラスト比を維持しているか
- [ ] 画像に適切な `alt` 属性が設定されているか
- [ ] フォーム要素に `<label>` が関連付けられているか

## テスト

- [ ] 新しい機能にテストが追加されているか
- [ ] テストファイルは対象ファイルと同じディレクトリに配置されているか
- [ ] テストファイル名は `*.test.tsx` または `*.spec.tsx` の形式か
- [ ] 各テストは独立して実行可能か
- [ ] テスト間で状態を共有していないか
- [ ] `beforeEach` / `afterEach` でセットアップ・クリーンアップを行っているか
- [ ] テストケース名は `should` を使って期待する動作を記述しているか
- [ ] AAA パターン (Arrange, Act, Assert) を使用しているか
- [ ] 外部依存（API、データベース）はモック化されているか
- [ ] すべてのテストが成功しているか (`npm test`)

## コードフォーマット・Lint

- [ ] ESLintの警告・エラーがないか
- [ ] Prettierでコードが自動整形されているか
- [ ] `.editorconfig` の設定に従っているか

## Git / プルリクエスト

- [ ] ブランチ名は適切な命名規則に従っているか
  - 機能追加: `feature/<機能名>`
  - バグ修正: `fix/<バグの概要>`
  - ドキュメント更新: `docs/<更新内容>`
  - リファクタリング: `refactor/<対象>`
- [ ] コミットメッセージは明確で簡潔か
- [ ] コミットメッセージは推奨フォーマットに従っているか
  - `<type>(<scope>): <subject>`
  - type: feat, fix, docs, style, refactor, test, chore など
- [ ] PRの説明に以下が含まれているか
  - 変更内容の要約
  - テスト方法
  - スクリーンショット (UI変更の場合)
  - 関連するIssue番号
- [ ] マージ前にコードレビューを受けているか

## CI/CD

- [ ] GitHub Actionsのワークフローが成功しているか
  - ESLint チェック
  - Prettier チェック
  - TypeScript型チェック
  - テスト実行
  - ビルド確認

## ドキュメント

- [ ] 複雑なロジックにコメントが追加されているか
- [ ] JSDoc形式でコメントが記述されているか
- [ ] 「なぜ」を説明するコメントが含まれているか
- [ ] APIの変更がある場合、ドキュメントを更新したか
- [ ] README.mdが最新の状態か

## パフォーマンス

- [ ] 不要な再レンダリングを避ける工夫がされているか
- [ ] 画像は最適化されているか（WebP形式、遅延ロード）
- [ ] コード分割が適切に行われているか (`React.lazy()`)
- [ ] データベースクエリは必要なカラムのみ取得しているか
- [ ] 頻繁に検索されるカラムにインデックスが設定されているか

## その他

- [ ] 変数名・関数名は意味がわかりやすいか
- [ ] 定数は `UPPER_SNAKE_CASE` で命名されているか
- [ ] 新しいファイルを作成する必要があったか（既存ファイルの編集を優先）
- [ ] セキュリティリスクがないか（XSS、CSRF、SQLインジェクション）
- [ ] 依存関係に既知の脆弱性がないか (`npm audit`)
